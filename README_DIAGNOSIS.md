# üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è –ø–∞–º—è—Ç–∏ mockkStatic(MediaStore)

> **–í–µ—Ç–∫–∞**: `diag-mockk-mediastore-memory`  
> **–î–∞—Ç–∞**: 2024-11-09  
> **–°—Ç–∞—Ç—É—Å**: ‚úÖ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞

---

## üìã –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ü—Ä–æ–±–ª–µ–º–∞
Unit-—Ç–µ—Å—Ç—ã —Å mockkStatic(MediaStore, DocumentsContract) –ø–æ—Ç—Ä–µ–±–ª—è—é—Ç **1-2 GB –ø–∞–º—è—Ç–∏**.

### –†–µ—à–µ–Ω–∏–µ
–í—ã–Ω–µ—Å—Ç–∏ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –≤—ã–∑–æ–≤—ã –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (–ø–∞—Ç—Ç–µ—Ä–Ω —É–∂–µ —á–∞—Å—Ç–∏—á–Ω–æ –µ—Å—Ç—å –≤ –∫–æ–¥–µ).

### –≠—Ñ—Ñ–µ–∫—Ç
**‚Üì 90% –ø–∞–º—è—Ç–∏** (—Å 1-2 GB –¥–æ 100-200 MB) + **‚Üë 30-50% —Å–∫–æ—Ä–æ—Å—Ç—å**.

### –¢—Ä—É–¥–æ—ë–º–∫–æ—Å—Ç—å
**3-4 —á–∞—Å–∞** —Ä–∞–±–æ—Ç—ã.

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

| –î–æ–∫—É–º–µ–Ω—Ç | –†–∞–∑–º–µ—Ä | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|--------|----------|
| **[TASK_RESULT.md](TASK_RESULT.md)** | 6 KB | üìä –°–≤–æ–¥–Ω—ã–π –æ—Ç—á—ë—Ç —Å –≤—ã–≤–æ–¥–∞–º–∏ |
| **[mockk-memory-diagnosis.md](docs/mockk-memory-diagnosis.md)** | 18 KB | üìñ –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Å –¥–µ—Ç–∞–ª—è–º–∏ |
| **[mockk-memory-diagnosis-summary.md](docs/mockk-memory-diagnosis-summary.md)** | 4 KB | ‚ö° –ö—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞ –¥–ª—è —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞ |

---

## üéØ –ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã

### –ì–¥–µ –ø—Ä–æ–±–ª–µ–º–∞
1. `core/data/.../SaFileRepositoryTest.kt` ‚Äî **15 —Ç–µ—Å—Ç–æ–≤** —Å mockkStatic
2. `feature/viewer/.../ViewerViewModelBatchDeleteTest.kt` ‚Äî **1 —Ç–µ—Å—Ç** —Å mockkStatic

### –ü–æ—á–µ–º—É —Ç—è–∂–µ–ª–æ
```kotlin
mockkStatic(MediaStore::class)        // 100 MB ‚Äî —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä—É–µ—Ç ~70 –º–µ—Ç–æ–¥–æ–≤
mockkStatic(DocumentsContract::class) //  50 MB ‚Äî —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä—É–µ—Ç ~40 –º–µ—Ç–æ–¥–æ–≤
mockkStatic(DocumentFile::class)      //  30 MB ‚Äî —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä—É–µ—Ç ~20 –º–µ—Ç–æ–¥–æ–≤
```

### –ö–∞–∫ —Ä–µ—à–∏—Ç—å
```kotlin
// ‚úÖ –£–∂–µ –µ—Å—Ç—å –≤ –∫–æ–¥–µ:
internal var mediaStoreVolumeResolver: (Uri) -> String? = { ... }

// ‚úÖ –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:
internal var documentsContractGetDocumentId: (Uri) -> String = { ... }
internal var documentsContractBuildDocumentUri: (Uri, String) -> Uri = { ... }
// ... –∏ –µ—â—ë 2-3 –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
```

---

## üìä –¶–∏—Ñ—Ä—ã

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ | –ü–æ—Å–ª–µ | ‚Üì/‚Üë |
|---------|-----|-------|-----|
| –ü–∞–º—è—Ç—å –Ω–∞ —Ç–µ—Å—Ç | 100-180 MB | 10-20 MB | **‚Üì 90%** |
| –û–±—â–µ–µ (15 —Ç–µ—Å—Ç–æ–≤) | 1-2 GB | 100-200 MB | **‚Üì 90%** |
| –°–∫–æ—Ä–æ—Å—Ç—å | –ë–∞–∑–æ–≤–∞—è | +30-50% | **‚Üë –ë—ã—Å—Ç—Ä–µ–µ** |

---

## üöÄ Next Steps

1. **–ü—Ä–æ—á–∏—Ç–∞—Ç—å** [TASK_RESULT.md](TASK_RESULT.md)
2. **–û–±—Å—É–¥–∏—Ç—å** —Å –∫–æ–º–∞–Ω–¥–æ–π –ø–æ–¥—Ö–æ–¥
3. **–°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É** –Ω–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é
4. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å** –ø–æ action items
5. **–ò–∑–º–µ—Ä–∏—Ç—å** —Ä–µ–∑—É–ª—å—Ç–∞—Ç

---

## üì¶ –ö–æ–º–º–∏—Ç—ã

```
feddeae docs: —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç –ø–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–µ
acf80e8 docs: –∫—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞ –ø–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–µ –ø–∞–º—è—Ç–∏ mockkStatic
f32b656 docs: –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è –ø–∞–º—è—Ç–∏ mockkStatic(MediaStore)
```

---

## ‚ö° TL;DR

**–ù–µ —É–≤–µ–ª–∏—á–∏–≤–∞—Ç—å heap, –∞ –ø–µ—Ä–µ–¥–µ–ª–∞—Ç—å —Ç–µ—Å—Ç—ã**:
- –£–±—Ä–∞—Ç—å mockkStatic (—Ç—è–∂—ë–ª–æ–µ)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (–ª—ë–≥–∫–æ–µ)
- –í—ã–∏–≥—Ä–∞—Ç—å 90% –ø–∞–º—è—Ç–∏ –∑–∞ 3-4 —á–∞—Å–∞

---

**–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏**: —Å–º. [TASK_RESULT.md](TASK_RESULT.md)
